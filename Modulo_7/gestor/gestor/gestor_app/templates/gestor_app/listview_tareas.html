{% extends "gestor_app/base.html" %}
{% block body %}
  <h1>Tareas ListView</h1>
  <form method="get" action="{% url 'tareas-list' %}">
    <label for="estado_filter">Estado:</label>
    <select name="estado_filter" id="estado_filter">
      <option value="">All</option>
      {% for choice in tarea_form.fields.estado.choices %}
        <option value="{{ choice.0 }}" {% if choice.0 == request.GET.estado_filter %}selected{% endif %}>
          {{ choice.1 }}
        </option>
      {% endfor %}
    </select>

    <label for="categoria_filter">Categoría:</label>
    <select name="categoria_filter" id="categoria_filter">
      <option value="">All</option>
      {% for choice in tarea_form.fields.categoría.choices %}
        <option value="{{ choice.0 }}" {% if choice.0 == request.GET.categoria_filter %}selected{% endif %}>
          {{ choice.1 }}
        </option>
      {% endfor %}
    </select>

    <button type="submit">Filter</button>
  </form>

  <table class="table">
    <thead class="thead-dark">
      <tr>
        <th>Título</th>
        <th>Descripción</th>
        <th>Fecha</th>
        <th>Hora</th>
        <th>Estado</th>
        <th>Categoría</th>
        <th>Edit</th>
      </tr>
    </thead>
    <tbody>
      {% for tarea in object_list %}
        <tr>
          <td>{{ tarea.título }}</td>
          <td>{{ tarea.descripción }}</td>
          <td>{{ tarea.vencimiento_fecha|date:"d-m-Y" }}</td>
          <td>{{ tarea.vencimiento_hora|time:"H:i" }}</td>
          <td>
            <form method="post" action="{% url 'tareas-list' %}">
              {% csrf_token %}
              {{ tarea.estado }}
              <select name="estado" onchange="this.form.submit()">
                {% for choice in tarea_form.fields.estado.choices %}
                  <option value="{{ choice.0 }}" {% if choice.0 == tarea.estado %}selected{% endif %}>
                    {{ choice.1 }}
                  </option>
                {% endfor %}
              </select>
              <input type="hidden" name="tarea_id" value="{{ tarea.id }}">
            </form>
          </td>
          <td>
            <form method="post" action="{% url 'tareas-list' %}">
              {% csrf_token %}
              {{ tarea.categoría }}
              <select name="categoria" onchange="this.form.submit()">
                {% for choice in tarea_form.fields.categoría.choices %}
                  <option value="{{ choice.0 }}" {% if choice.0 == tarea.categoría %}selected{% endif %}>
                    {{ choice.1 }}
                  </option>
                {% endfor %}
              </select>
              <input type="hidden" name="tarea_id" value="{{ tarea.id }}">
            </form>
          </td>
          <td>
            <a href="{% url 'tareas-edit' tarea.id %}">Editar</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
